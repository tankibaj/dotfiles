#!/usr/bin/env bash

aws_profile_list() {
  IFS=';' # https://en.wikipedia.org/wiki/Input_Field_Separators

  read -ra PROFILES <<< "$(aws configure list-profiles | tr '\n' ';')"

  local COUNT=1
  for i in ${PROFILES[@]}; do
    read -ra ITEMS <<< "${i}"
    echo "  ${COUNT}) ${ITEMS[0]}" >&2
    ((COUNT=COUNT+1))
  done

  local SELECT=0
  while [[ ${SELECT} -lt 1 || ${SELECT} -ge $COUNT ]]; do
    read -p "Pick an AWS profile: " SELECT >&2
  done

  echo "${PROFILES[(SELECT-1)]}"
}

AWS_PROFILE=$(aws_profile_list) zsh